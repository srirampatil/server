--source include/master-slave.inc

connection master;
CREATE TABLE t1(id INT);
CREATE INDEX idx ON t1(id);

--error ER_DUP_KEYNAME
ALTER TABLE t1 ADD INDEX idx(id);

ALTER TABLE t1 ADD INDEX IF NOT EXISTS idx(id);

--echo # Syncing slave with master
sync_slave_with_master;

--error ER_DUP_KEYNAME
CREATE INDEX idx ON t1(id);


connection master;
CREATE OR REPLACE INDEX idx2 ON t1(id);
ALTER TABLE t1 ADD INDEX IF NOT EXISTS idx2(id);

CREATE OR REPLACE UNIQUE INDEX idx ON t1(id);

--error ER_DUP_KEYNAME
CREATE INDEX idx ON t1(id);

--echo # Syncing slave with master
sync_slave_with_master;

--error ER_DUP_KEYNAME
CREATE INDEX idx2 ON t1(id);

connection master;
CREATE TABLE t2(col INT);
CREATE OR REPLACE INDEX idx ON t2(col);

--error ER_DUP_KEYNAME
CREATE INDEX idx ON t2(col);

ALTER TABLE t1 ADD PRIMARY KEY (id);

--error ER_MULTIPLE_PRI_KEY
ALTER TABLE t1 ADD PRIMARY KEY (id);

ALTER TABLE t2 ADD CONSTRAINT fk FOREIGN KEY (col) REFERENCES t1(id);
DESC t2;

CREATE INDEX fk ON t2(col);

--echo # Syncing slave with master
sync_slave_with_master;

ALTER TABLE t2 ADD CONSTRAINT fk FOREIGN KEY (col) REFERENCES t1(id);

connection master;
--echo # Clearing up
DROP INDEX idx ON t1;
DROP TABLE t1;

--error ER_NO_SUCH_TABLE
ALTER TABLE t1 DROP INDEX idx2;

ALTER TABLE t2 DROP INDEX idx;
ALTER TABLE t2 DROP INDEX fk;
ALTER TABLE t2 DROP FOREIGN KEY fk;
DROP TABLE t2;

--echo # Syncing slave with master
sync_slave_with_master;

--source include/rpl_end.inc
