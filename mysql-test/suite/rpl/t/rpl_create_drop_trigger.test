--source include/master-slave.inc

connection master;
CREATE DATABASE db1;
USE db1;
CREATE TABLE t1 (val INT);
CREATE TRIGGER val_sum BEFORE INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;
SET @sum=0;
INSERT INTO t1 VALUES (10), (20), (30);
SELECT @sum;

--echo # Syncing slave with master
sync_slave_with_master;

connection master;
--error ER_NOT_SUPPORTED_YET
CREATE TRIGGER IF NOT EXISTS val_sum_new BEFORE INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;

CREATE TRIGGER IF NOT EXISTS val_sum AFTER INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;

--error ER_WRONG_USAGE
CREATE OR REPLACE TRIGGER IF NOT EXISTS val_sum BEFORE INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;
SELECT @sum;

--echo # Syncing slave with master
sync_slave_with_master;

connection master;
CREATE OR REPLACE TRIGGER val_sum BEFORE INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;

--echo # ER_TRG_ALREADY_EXISTS
--error 1359
CREATE TRIGGER val_sum BEFORE INSERT ON t1 FOR EACH ROW SET @sum = @sum + NEW.val;

--echo # Syncing slave with master
sync_slave_with_master;

connection master;
--echo # Clearing up
DROP TRIGGER val_sum;
DROP TABLE t1;
DROP TRIGGER IF EXISTS val_sum;

--error ER_TRG_DOES_NOT_EXIST
DROP TRIGGER random_trigger;
DROP DATABASE db1;

--echo # ER_NO_DB_ERROR
--error 1046
DROP TRIGGER IF EXISTS val_sum;

--echo # Syncing slave with master
sync_slave_with_master;

--error ER_TRG_DOES_NOT_EXIST
DROP TRIGGER val_sum;

--source include/rpl_end.inc
