include/master-slave.inc
[connection master]
CREATE TABLE t1(id INT);
CREATE INDEX idx ON t1(id);
ALTER TABLE t1 ADD INDEX idx(id);
ERROR 42000: Duplicate key name 'idx'
ALTER TABLE t1 ADD INDEX IF NOT EXISTS idx(id);
Warnings:
Note	1061	Duplicate key name 'idx'
# Syncing slave with master
CREATE INDEX idx ON t1(id);
ERROR 42000: Duplicate key name 'idx'
CREATE OR REPLACE INDEX idx2 ON t1(id);
Warnings:
Note	1831	Duplicate index 'idx2' defined on the table 'test.t1'. This is deprecated and will be disallowed in a future release.
ALTER TABLE t1 ADD INDEX IF NOT EXISTS idx2(id);
Warnings:
Note	1061	Duplicate key name 'idx2'
CREATE OR REPLACE UNIQUE INDEX idx ON t1(id);
CREATE INDEX idx ON t1(id);
ERROR 42000: Duplicate key name 'idx'
# Syncing slave with master
CREATE INDEX idx2 ON t1(id);
ERROR 42000: Duplicate key name 'idx2'
CREATE TABLE t2(col INT);
CREATE OR REPLACE INDEX idx ON t2(col);
CREATE INDEX idx ON t2(col);
ERROR 42000: Duplicate key name 'idx'
ALTER TABLE t1 ADD PRIMARY KEY (id);
ALTER TABLE t1 ADD PRIMARY KEY (id);
ERROR 42000: Multiple primary key defined
ALTER TABLE t2 ADD CONSTRAINT fk FOREIGN KEY (col) REFERENCES t1(id);
DESC t2;
Field	Type	Null	Key	Default	Extra
col	int(11)	YES	MUL	NULL	
CREATE INDEX fk ON t2(col);
Warnings:
Note	1831	Duplicate index 'fk' defined on the table 'test.t2'. This is deprecated and will be disallowed in a future release.
# Syncing slave with master
ALTER TABLE t2 ADD CONSTRAINT fk FOREIGN KEY (col) REFERENCES t1(id);
# Clearing up
DROP INDEX idx ON t1;
DROP TABLE t1;
ALTER TABLE t1 DROP INDEX idx2;
ERROR 42S02: Table 'test.t1' doesn't exist
ALTER TABLE t2 DROP INDEX idx;
ALTER TABLE t2 DROP INDEX fk;
ALTER TABLE t2 DROP FOREIGN KEY fk;
DROP TABLE t2;
# Syncing slave with master
include/rpl_end.inc
